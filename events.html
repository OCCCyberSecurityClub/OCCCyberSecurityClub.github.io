<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Events - OCC CIS Club</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <nav class="container">
            <div class="logo">OCC CIS Club</div>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="events.html">Events</a></li>
                <!-- <li><a href="videos.html">Videos</a></li>
                <li><a href="more.html">More</a></li> -->
            </ul>
        </nav>
    </header>

    <main>
        <section class="hero container">
            <h1>Upcoming Events</h1>
            <p class="subtitle">Stay updated with our latest cybersecurity events and activities</p>
        </section>

        <section class="events-section container">
            <div id="loading" class="loading-message">
                <p>Loading events...</p>
            </div>
            
            <div id="error" class="error-message" style="display: none;">
                <p>Unable to load events. Please try again later.</p>
            </div>
            
            <div id="events-container" class="events-container">
                <!-- Events will be dynamically loaded here -->
            </div>
        </section>
    </main>

    <!-- Event Popup Modal -->
    <div id="event-popup" class="popup-overlay">
        <div class="popup-container">
            <div id="popup-content" class="popup-content">
                <!-- Popup content will be dynamically loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Function to load events from events.txt
        async function loadEvents() {
            try {
                const response = await fetch('events.txt');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const text = await response.text();
                const events = parseEvents(text);
                displayEvents(events);
                
                // Hide loading message
                document.getElementById('loading').style.display = 'none';
                
            } catch (error) {
                console.error('Error loading events:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
            }
        }

        // Function to parse events from text file
        function parseEvents(text) {
            const lines = text.trim().split('\n');
            const events = [];
            
            lines.forEach(line => {
                if (line.trim()) {
                    const parts = line.split('|');
                    if (parts.length >= 6) {
                        events.push({
                            title: parts[0].trim(),
                            date: parts[1].trim(),
                            time: parts[2].trim(),
                            description: parts[3].trim(),
                            moreInfo: parts[4].trim(),
                            image: parts[5] ? parts[5].trim() : null
                        });
                    }
                }
            });
            
            // Sort events by date
            events.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            return events;
        }

        // Function to format date for display
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                weekday: 'long'
            };
            return date.toLocaleDateString('en-US', options);
        }

        // Function to check if event is upcoming
        function isUpcoming(dateString) {
            const eventDate = new Date(dateString);
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            return eventDate >= today;
        }

        // Function to display events
        function displayEvents(events) {
            const container = document.getElementById('events-container');
            
            if (events.length === 0) {
                container.innerHTML = '<div class="no-events"><p>No events scheduled at this time.</p></div>';
                return;
            }
            
            const upcomingEvents = events.filter(event => isUpcoming(event.date));
            const pastEvents = events.filter(event => !isUpcoming(event.date));
            
            let html = '';
            
            // Display upcoming events
            if (upcomingEvents.length > 0) {
                html += '<h2 class="events-section-title">Upcoming Events</h2>';
                upcomingEvents.forEach(event => {
                    html += createEventHTML(event, false);
                });
            }
            
            // Display past events
            if (pastEvents.length > 0) {
                html += '<h2 class="events-section-title">Past Events</h2>';
                pastEvents.reverse().forEach(event => {
                    html += createEventHTML(event, true);
                });
            }
            
            container.innerHTML = html;
        }

        // Function to create HTML for a single event
        function createEventHTML(event, isPast) {
            const eventClass = isPast ? 'event-card past-event' : 'event-card';
            const imageHTML = event.image ? 
                `<div class="event-image">
                    <img src="${event.image}" alt="${event.title}" onerror="this.parentElement.style.display='none'">
                </div>` : '';
            
            return `
                <div class="${eventClass}" onclick="showEventPopup('${event.title.replace(/'/g, "\\'")}', '${formatDate(event.date)}', '${event.time}', '${event.description.replace(/'/g, "\\'")}', '${event.moreInfo.replace(/'/g, "\\'")}', '${event.image || ''}')">
                    ${imageHTML}
                    <div class="event-date">
                        <span class="date-text">${formatDate(event.date)}</span>
                        <span class="time-text">${event.time}</span>
                        ${isPast ? '<span class="past-label">Past Event</span>' : '<span class="upcoming-label">Upcoming</span>'}
                    </div>
                    <div class="event-content">
                        <h3 class="event-title">${event.title}</h3>
                        <p class="event-description">${event.description}</p>
                        <p class="click-for-more">Click for more information</p>
                    </div>
                </div>
            `;
        }

        // Function to show event popup
        function showEventPopup(title, date, time, description, moreInfo, image) {
            const popup = document.getElementById('event-popup');
            const popupContent = document.getElementById('popup-content');
            
            const imageHTML = image ? 
                `<div class="popup-image">
                    <img src="${image}" alt="${title}" onerror="this.style.display='none'">
                </div>` : '';
            
            popupContent.innerHTML = `
                <div class="popup-header">
                    <h2>${title}</h2>
                    <span class="close-popup" onclick="closeEventPopup()">&times;</span>
                </div>
                ${imageHTML}
                <div class="popup-details">
                    <p><strong>Date:</strong> ${date}</p>
                    <p><strong>Time:</strong> ${time}</p>
                    <p><strong>Description:</strong> ${description}</p>
                    <div class="more-info">
                        <h3>More Information:</h3>
                        <p>${moreInfo.replace(/\\n/g, '<br>')}</p>
                    </div>
                </div>
            `;
            
            popup.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }

        // Function to close event popup
        function closeEventPopup() {
            const popup = document.getElementById('event-popup');
            popup.style.display = 'none';
            document.body.style.overflow = 'auto';
        }

        // Close popup when clicking outside of it
        window.onclick = function(event) {
            const popup = document.getElementById('event-popup');
            if (event.target === popup) {
                closeEventPopup();
            }
        }

        // Load events when page loads
        document.addEventListener('DOMContentLoaded', loadEvents);

        // Optional: Refresh events every 5 minutes
        setInterval(loadEvents, 5 * 60 * 1000);
    </script>
</body>
</html>
